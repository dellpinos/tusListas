(function(){const l=document.querySelector("#contenedor-input"),d=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),m=document.querySelector("#producto-nombre-falso"),s=document.querySelector("#btn-nombre"),p=document.querySelector("#card-producto"),_=document.querySelector("#producto-codigo");let g=0,S=[],c=[];s.addEventListener("click",function(a){a.preventDefault(),n()}),m.addEventListener("click",function(){n()});function n(){const a=document.createElement("DIV");a.classList.add("buscador__opciones-contenedor");const o=document.createElement("INPUT");o.type="text",o.name="producto-nombre",o.classList.add("buscador__campo","buscador__campo-focus"),o.placeholder="Pipeta power, Pecera 60x20, Collar Cuero, etc",m.value!==""&&(o.value=m.value),a.appendChild(o);const i=document.createElement("UL");a.appendChild(i),l.appendChild(a),o.focus(),o.addEventListener("input",function(t){g===1&&t.target.value.length<3&&(g=0),C(t)}),l.addEventListener("mouseleave",function(){for(m.value=o.value;a.firstChild;)a.removeChild(a.firstChild);a.remove()});async function C(t){try{g||(S=await q(t.target.value))}catch(r){console.log(r)}g&&f(t)}async function q(t){if(t.length===3)try{const r=new FormData;r.append("input_producto",t);let e=await(await fetch("/api/buscador/producto",{method:"POST",headers:{"X-CSRF-TOKEN":d},body:r})).json();return g=1,e}catch{console.log("El servidor no responde")}}function f(t){const r=t.target.value,v=new RegExp(r,"i");c=S.filter(h=>{if(h.nombre.toLowerCase().search(v)!==-1)return h}),w()}function w(){for(;i.firstChild;)i.removeChild(i.firstChild);let t=0;c.forEach(r=>{if(t++,t<=4){const v=document.createElement("LI");v.textContent=r.nombre,v.addEventListener("click",function(h){L(r.id)}),i.appendChild(v)}})}async function L(t){try{const r=new FormData;r.append("id",t);let e=await(await fetch("/api/buscador/producto-individual",{method:"POST",headers:{"X-CSRF-TOKEN":d},body:r})).json();e.producto.venta=b(e.producto.venta);const u=new Date(e.precio.updated_at),y=u.getMonth(),F=u.getDate()+1,k=u.getFullYear(),E=new Date(Date.UTC(k,y,F)),$={weekday:"long",year:"numeric",month:"long",day:"numeric"},D=E.toLocaleDateString("es-AR",$);e.producto.unidad_fraccion===null&&(e.producto.unidad_fraccion=""),p.innerHTML=`
                <a href="/producto/producto-show/${e.producto.id}" class="producto__grid-card">
                    <div class=" producto__contenedor ">
                        <p><span class=" font-bold">Código: </span>${e.producto.codigo.toUpperCase()}</p>
                        <p><span class=" font-bold">Producto: </span>${e.producto.nombre}</p>
                        <p><span class=" font-bold">Ganancia aplicada: </span>${e.producto.ganancia}</p>
                        <p><span class=" font-bold">Costo sin IVA: $ </span>${e.precio.precio}</p>
                        <p><span class=" font-bold">Precio venta: $ </span>${e.producto.venta} <span class="font-bold">${e.producto.unidad_fraccion}</span></p>
                        <p><span class=" font-bold">Modificación: </span>${D}</p>
                    </div>
                    <a href="/producto/producto-edit/${e.producto.id}" class="producto__card-contenedor-boton producto__boton producto__boton--verde">Modificar</a>
                </a>
                `,m.value="",_.value=""}catch{console.log("El servidor no responde")}}}function b(a){return Math.ceil(a/10)*10}})();(function(){const l=document.querySelector("#producto-codigo"),d=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),m=document.querySelector("#btn-codigo"),s=document.querySelector("#card-producto"),p=document.querySelector("#producto-nombre-falso");l.addEventListener("keydown",function(c){if(c.key==="Enter"&&l.value.length>=4){let n=l.value;_(n.toLowerCase())}}),m.addEventListener("click",function(c){if(l.value.length>=4){let n=l.value;_(n.toLowerCase())}});async function _(c){try{const n=new FormData;n.append("codigo_producto",c);const o=await(await fetch("/api/buscador/producto-codigo",{method:"POST",headers:{"X-CSRF-TOKEN":d},body:n})).json();if(!o){s.innerHTML=`
                    <div class=" producto__contenedor ">
                        <p><span class=" font-bold">El código no existe</p>
                    </div>
                `,p.value="",l.value="";return}g(o[0].id)}catch{console.log("El servidor no responde")}}async function g(c){try{const n=new FormData;n.append("id",c);let o=await(await fetch("/api/buscador/producto-individual",{method:"POST",headers:{"X-CSRF-TOKEN":d},body:n})).json();o.producto.venta=S(o.producto.venta);const i=new Date(o.precio.updated_at),C=i.getMonth(),q=i.getDate()+1,f=i.getFullYear(),w=new Date(Date.UTC(f,C,q)),L={weekday:"long",year:"numeric",month:"long",day:"numeric"},t=w.toLocaleDateString("es-AR",L);o.producto.unidad_fraccion===null&&(o.producto.unidad_fraccion=""),s.innerHTML=`
            <a href="/producto/producto-show/${o.producto.id}" class="producto__grid-card">
                <div class=" producto__contenedor ">
                    <p><span class=" font-bold">Código: </span>${o.producto.codigo.toUpperCase()}</p>
                    <p><span class=" font-bold">Producto: </span>${o.producto.nombre}</p>
                    <p><span class=" font-bold">Ganancia aplicada: </span>${o.producto.ganancia}</p>
                    <p><span class=" font-bold">Costo sin IVA: $ </span>${o.precio.precio}</p>
                    <p><span class=" font-bold">Precio venta: $ </span>${o.producto.venta} <span class="font-bold">${o.producto.unidad_fraccion}</span></p>
                    <p><span class=" font-bold">Modificación: </span>${t}</p>
                </div>
                <a href="/producto/producto-edit/${o.producto.id}" class="producto__card-contenedor-boton producto__boton producto__boton--verde">Modificar</a>
            </a>
            `,p.value="",l.value=""}catch{console.log("El servidor no responde")}}function S(c){return Math.ceil(c/10)*10}})();(function(){const l=document.querySelector("#ganancia-personalizada"),d=document.querySelector("#ganancia"),m=document.querySelector("#contenedor-radios"),s=document.querySelector("#precio"),p=document.querySelector("#precio-iva"),_=document.querySelector("#btn-venta"),g=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),S=document.querySelector("#precio-venta"),c=document.querySelector("#check-fraccion"),n=document.querySelector("#producto-contenedor-oculto");let b=document.querySelector("#codigo-fraccionado");const a=document.querySelector("#unidad-fraccion"),o=document.querySelector("#contenido-total"),i=document.querySelector("#ganancia-fraccion"),C=document.querySelector("#precio-fraccionado"),q=document.querySelector("#btn-fraccionado");let f=0;document.addEventListener("DOMContentLoaded",function(){p.value!==void 0&&s.value!==""&&(p.value=Math.round(s.value*1.21))}),m.addEventListener("click",function(){w()}),s.addEventListener("input",function(){p.value=Math.round(s.value*1.21)}),p.addEventListener("input",function(){s.value=Math.round(p.value/1.21)}),_.addEventListener("click",function(){L()});function w(){d.disabled===!0&&l.checked===!0?(d.disabled=!1,d.classList.remove("formulario__campo--no-activo")):(d.disabled=!0,d.classList.add("formulario__campo--no-activo"),d.value="")}async function L(){const e=document.querySelector('input[type="radio"]:checked');if(e.value==="personalizada")f=s.value*1.21*d.value;else if(e.value==="proveedor"){const u=document.querySelector("#proveedor");ganancia=await t(e.value,u.value),f=s.value*1.21*ganancia}else{const u=document.querySelector("#categoria");ganancia=await t(e.value,u.value),f=s.value*1.21*ganancia}S.value=h(f),c&&c.checked===!0&&(c.checked=!1,v())}async function t(e,u){try{const y=new FormData;y.append("ganancia",e),y.append("id",u);let E=await(await fetch("/api/calculo/ganancia",{method:"POST",headers:{"X-CSRF-TOKEN":g},body:y})).json();return d.value=E,E}catch{console.log("El servidor no responde")}}q.addEventListener("click",r),c&&c.addEventListener("click",function(){if(c.checked===!0){console.log("visible!"),n.classList.add("producto-formulario__contenedor-visible"),n.classList.remove("producto-formulario__contenedor-oculto"),b.value===""&&(async()=>{const u=await e();b.value=u.toUpperCase()})(),a.required=!0,o.required=!0,i.required=!0;async function e(){try{return await(await fetch("/api/codigo-unico")).json()}catch(u){console.log(u)}}}else v()});async function r(){f?C.value=h(Math.round(f/o.value*i.value)):console.log("Debes calcular el precio No Fraccionado primero")}function v(){console.log("invisible!"),n.classList.add("producto-formulario__contenedor-oculto"),n.classList.remove("producto-formulario__contenedor-visible"),a.required=!1,o.required=!1,i.required=!1,a.value="",o.value="",i.value="",C.value="",b=""}function h(e){return Math.ceil(e/10)*10}})();
